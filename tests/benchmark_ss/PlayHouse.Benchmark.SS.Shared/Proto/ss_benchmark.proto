syntax = "proto3";

package playhouse.benchmark.ss;

option csharp_namespace = "PlayHouse.Benchmark.SS.Shared.Proto";

// ============================================
// Server-to-Server Benchmark Messages
// ============================================

// Stage 생성 요청 (HTTP 클라이언트 → API Server)
message CreateStageRequest {
    string play_nid = 1;
    string stage_type = 2;
    int64 stage_id = 3;
}

// Stage 생성 응답 (API Server → HTTP 클라이언트)
message CreateStageReply {
    bool success = 1;
    int32 error_code = 2;
    int64 stage_id = 3;
    string play_nid = 4;
    string error_message = 5;
}

// 클라이언트 → Stage 트리거 요청 (API 통신)
message TriggerApiRequest {
    int32 sequence = 1;
    int32 response_size = 2;
    int64 client_timestamp = 3;
    bytes payload = 4;
    SSCommMode comm_mode = 5;  // RequestAsync or RequestCallback
}

// Stage → 클라이언트 응답 (API 통신 결과)
message TriggerApiReply {
    int32 sequence = 1;
    int64 ss_elapsed_ticks = 2;      // Stage→Api 구간 측정
    int64 total_elapsed_ticks = 3;   // 전체 처리 시간
    bytes payload = 4;
}

// 클라이언트 → Stage 트리거 요청 (Stage간 통신)
message TriggerStageRequest {
    int32 sequence = 1;
    int32 response_size = 2;
    int64 client_timestamp = 3;
    int64 target_stage_id = 4;
    string target_nid = 5;
    bytes payload = 6;
}

// Stage → 클라이언트 응답 (Stage간 통신 결과)
message TriggerStageReply {
    int32 sequence = 1;
    int64 ss_elapsed_ticks = 2;      // Stage→Stage 구간 측정
    int64 total_elapsed_ticks = 3;   // 전체 처리 시간
    bytes payload = 4;
}

// Stage간/API 내부 메시지
message SSBenchmarkRequest {
    int32 sequence = 1;
    int32 response_size = 2;
}

message SSBenchmarkReply {
    int32 sequence = 1;
    bytes payload = 2;
}

// ============================================
// 서버 내부 반복 벤치마크 (New)
// ============================================

// 서버 간 호출 유형
enum SSCallType {
    STAGE_TO_API = 0;
    STAGE_TO_STAGE = 1;
    API_TO_API = 2;
}

// 통신 모드
enum SSCommMode {
    REQUEST_ASYNC = 0;
    REQUEST_CALLBACK = 1;
}

// 벤치마크 시작 요청 (클라이언트 → 서버 트리거)
message StartSSBenchmarkRequest {
    int32 iterations = 1;
    int32 request_size = 2;
    int32 response_size = 3;
    SSCallType call_type = 4;
    SSCommMode comm_mode = 5;
    string target_nid = 6;       // StageToStage용
    int64 target_stage_id = 7;   // StageToStage용
    string target_api_nid = 8;   // ApiToApi용
}

// 벤치마크 결과 응답 (서버 → 클라이언트)
message StartSSBenchmarkReply {
    SSCallType call_type = 1;
    SSCommMode comm_mode = 2;
    int32 total_iterations = 3;
    int32 success_count = 4;
    int32 failed_count = 5;
    double elapsed_seconds = 6;
    double throughput_per_sec = 7;
    double latency_mean_ms = 8;
    double latency_p50_ms = 9;
    double latency_p95_ms = 10;
    double latency_p99_ms = 11;
}
