syntax = "proto3";

package playhouse.benchmark.ss;

option csharp_namespace = "PlayHouse.Benchmark.SS.Shared.Proto";

// ============================================
// Server-to-Server Benchmark Messages
// ============================================

message CreateStageRequest {
    string play_nid = 1;
    string stage_type = 2;
    int64 stage_id = 3;
}

message CreateStageReply {
    bool success = 1;
    int32 error_code = 2;
    int64 stage_id = 3;
    string play_nid = 4;
    string error_message = 5;
}

enum SSCallType {
    STAGE_TO_API = 0;
    STAGE_TO_STAGE = 1;
}

enum SSCommMode {
    REQUEST_ASYNC = 0;
    REQUEST_CALLBACK = 1;
    SEND = 2;
}

// 벤치마크 시작 요청 (클라이언트 -> Stage)
message StartBenchmarkRequest {
    int32 duration_seconds = 1;
    int32 max_inflight = 2;
    int32 message_size = 3;
    SSCommMode comm_mode = 4;
    string target_nid = 5;
    int64 target_stage_id = 6;
}

// 벤치마크 결과 리포트 (Stage -> 클라이언트)
message BenchmarkResult {
    int64 total_sent = 1;
    int64 total_received = 2;
    double tps = 3;
    double p99_latency_ms = 4;
    double mean_latency_ms = 5;
    int32 duration_actual = 6;
}

// Case 1 & 2: Request-Reply용 메시지
message SSEchoRequest {
    bytes payload = 1;
}

message SSEchoReply {
    bytes payload = 1;
}

// Case 3: Send-Only(Pipeline)용 메시지
message SSEchoSend {
    bytes payload = 1;
}

message TriggerSSEchoRequest {
    int32 sequence = 1;
    bytes payload = 2;
    SSCommMode comm_mode = 3;
    SSCallType call_type = 4;
    string target_nid = 5;
    int64 target_stage_id = 6;
}

message TriggerSSEchoReply {
    int32 sequence = 1;
    bytes payload = 2;
}